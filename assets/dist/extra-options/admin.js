import{_ as e,R as t,a,r,b as n,c as l,d as i,e as s,Q as o}from"./QuantityInput-b8a39512.js";const c=e.createStore()(e.immer(e.devtools((e=>({openExtraDrawer:!1,isSaving:null,newExtra:()=>{e((e=>{e.openExtraDrawer=!0}))},editExtra:async t=>{e((e=>{e.selectedRow=t,e.openExtraDrawer=!0}))},closeExtraDrawer:()=>{e((e=>{e.selectedRow=void 0,e.openExtraDrawer=!1}))},updatePosition:async t=>{e((e=>{e.isSaving=t}))}})))));function m(){const e=c((e=>e.newExtra));return t.createElement("div",{className:"bw-flex bw-gap-2"},t.createElement(a.Button,{onClick:()=>e()},"New Extra"))}async function d(t){return await e.api.post("extras",{json:t}).json()}async function u(t){return await e.api.delete(`extras/${t}`).json()}async function b(){return await e.api.get("extras/public").json()}const w=[];var v=ReactDOM;const E=window.booksterMeta.appPath.bookster.assets+"/images/empty.png",x=r.forwardRef((function({className:r,extra:l,onClick:i,...s},o){return t.createElement("div",{onClick:i,ref:o,...s,className:a.clsx("bw-cursor-pointer bw-rounded bw-border bw-border-solid bw-border-base-border bw-p-4 bw-py-5 bw-transition bw-duration-300 bw-ease-in-out hover:bw-shadow-md",r)},t.createElement("div",{className:"bw-flex bw-items-start bw-space-x-4"},t.createElement("img",{className:"bw-aspect-[16/6] bw-h-16 bw-w-16 bw-flex-none bw-rounded bw-object-cover bw-object-center",src:l.transient_cover_url||E,alt:"Extra cover image"}),t.createElement("div",{className:"bw-flex bw-grow bw-flex-col bw-items-stretch bw-space-y-1"},t.createElement("div",{className:"bw-mb-2 bw-flex bw-justify-between"},t.createElement("div",{className:"bw-flex-1"},t.createElement("div",{className:"bw-overflow-auto bw-text-base bw-font-semibold"},l.name)),t.createElement("div",{className:"bw-flex-none"},l.activated?t.createElement(a.Badge,{variant:"outline",color:"success"},"Active"):t.createElement(a.Badge,{variant:"outline",color:"error"},"Inactive"))),t.createElement(f,null,t.createElement(p,null,"Duration:"),t.createElement(g,null,t.createElement(n.Clock,{className:"bw-mr-1 bw-h-3 bw-w-3"}),t.createElement("span",null,l.duration," mins"))),t.createElement(f,null,t.createElement(p,null,"Price:"),t.createElement(g,null,t.createElement(a.Badge,{color:"base",variant:"fill"},t.createElement("span",null,e.formatPrice(l.price))))),t.createElement(f,null,t.createElement(p,null,"Quantity:"),t.createElement(g,null,"disable"===l.quantity.activated?1:`1~${l.quantity.max}`)))))})),f=a.styled.div("bw-flex bw-h-5 bw-items-center"),p=a.styled.span("bw-text-xs bw-text-base-foreground/60 bw-flex-1"),g=a.styled.span("bw-text-xs bw-text-base-foreground/80 bw-flex-1 bw-flex bw-items-center");function y({extra:n,className:l,...i}){const s=c((e=>e.editExtra)),{setNodeRef:o,attributes:m,listeners:d,transition:u,transform:b,isDragging:w}=e.useSortable({id:`extra-${n.extra_id}`,data:{type:"extra",extra:n}}),v={transition:u,transform:e.dndCSS.Transform.toString(b?{...b,scaleX:1,scaleY:1}:b)},E=r.useCallback((e=>{e.stopPropagation(),s(n)}),[n]);return w?t.createElement("div",{ref:o,className:"bw-rounded-lg bw-border-2 bw-bg-base-bg2",style:v}):t.createElement("div",{className:a.cx("bw-rounded-lg bw-bg-base-bg1",l),style:v,ref:o,...m,...d,...i},t.createElement(h,{extra:n,onClick:E}))}const h=r.memo(x);function k(){const l=c((e=>e.newExtra)),i=c((e=>e.updatePosition)),[s,o]=r.useState(void 0),{data:m,isLoading:d}=e.useQuery({queryKey:["extras"],queryFn:async()=>(await b()).data,keepPreviousData:!0}),u=e.useSensors(e.useSensor(e.PointerSensor,{activationConstraint:{distance:5}}));return t.createElement("div",{className:"bw-grid bw-auto-rows-fr bw-grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] bw-gap-4 bw-p-4 bw-pt-0"},d&&!m?Array.from({length:6},((e,r)=>t.createElement("div",{key:r,className:"bw-space-y-4 bw-rounded-md bw-bg-base-bg1 bw-p-6 bw-shadow-sm"},Array.from({length:4},((e,r)=>t.createElement(a.Skeleton,{key:r,className:"bw-h-5"})))))):t.createElement(t.Fragment,null,t.createElement(e.DndContext,{sensors:u,onDragStart:function(e){var t;"extra"!==(null==(t=e.active.data.current)?void 0:t.type)||o(e.active.data.current.extra)},onDragOver:function(t){var a,r;const{active:n,over:l}=t;if(!l||!m)return;const i=null==(a=n.data.current)?void 0:a.extra.extra_id,s=null==(r=l.data.current)?void 0:r.extra.extra_id,o=m.findIndex((e=>e.extra_id===i)),c=m.findIndex((e=>e.extra_id===s));if(o===c)return m;const d=function(e,t){if(!m)return[];const a=[...m],r=a.splice(e,1);return a.splice(t,0,...r),a}(o,c);e.queryClient.setQueryData(["extras"],d)},onDragEnd:function(){void 0!==m&&(async function(t){try{i(!0),await async function(t){return await e.api.patch("extras",{json:{extraModels:t}}).json()}(t),i(!1)}catch(r){throw i(null),a.toast.error(await e.getErrorMsg(r)),r}}(m),o(void 0))}},t.createElement(e.SortableContext,{items:m?m.map((e=>`extra-${e.extra_id}`)):[],strategy:e.verticalListSortingStrategy},m&&m.length>0&&m.map((e=>t.createElement(y,{key:e.extra_id,extra:e})))),v.createPortal(t.createElement(e.DragOverlay,{className:"bookster-root"},s&&t.createElement(y,{className:"bw-opacity-90",extra:s})),document.body)),t.createElement("div",{className:"bw-min-h-[8rem]"},t.createElement(a.Button,{variant:"outline",size:"large",className:"bw-h-full bw-w-full bw-border-dashed bw-py-4 bw-text-primary hover:bw-shadow-md",onClick:()=>l()},t.createElement(n.Plus,{className:"bw-h-5 bw-w-5"})," New Extra"))))}var _=booksterModules.antd;function N(){const e=window.booksterPublicData.generalSettings.time_slot_step%60;return 0===e?60:e>0&&e<=30?e:e>30&&e<60?e%30:5}function F({onDelete:e,disabled:r}){return t.createElement(a.Popover,null,t.createElement(a.PopoverTrigger,{asChild:!0},t.createElement(a.Button,{className:"bw-mr-auto msm:bw-hidden",disabled:r,size:"icon",color:"error",variant:"outline",tabIndex:-1},t.createElement(n.Trash,null))),t.createElement(a.PopoverPortal,null,t.createElement(a.PopoverContent,null,t.createElement("div",{className:"bw-flex bw-items-start bw-gap-2"},t.createElement(n.Info,{className:"bw-h-5 bw-w-5 bw-fill-warning bw-text-base-bg1"}),"Deleting this Service Extra"),t.createElement("div",{className:"bw-mt-3 bw-flex bw-flex-row bw-justify-end bw-gap-2"},t.createElement(a.ReactPopover.Close,{asChild:!0},t.createElement(a.Button,{size:"small",color:"error",variant:"outline",onClick:()=>{e()}},"Delete"))))))}function C({formNamePrefix:e,service:n}){if(!n.service_id)return null;const[l,i]=r.useState(!0),s=_.Form.useFormInstance(),o=_.Form.useWatch(e,s);return r.useEffect((()=>{void 0!==o&&i(!o.includes(n.service_id))}),[o,n.service_id]),t.createElement(t.Fragment,null,t.createElement("div",{className:a.cx("bw-block bw-cursor-pointer bw-select-none bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap bw-rounded-sm bw-border-0 bw-border-l-4 bw-border-solid bw-p-4 bw-text-primary bw-shadow bw-transition-shadow bw-duration-200 bw-ease-in-out hover:bw-shadow-md",l?"bw-bg-primary/10":"bw-grayscale"),style:{borderLeftColor:n.theme_color},onClick:function(){const t=[...s.getFieldValue(e)];if(l)t.push(n.service_id);else{const e=null==t?void 0:t.indexOf(n.service_id);t.splice(e,1)}s.setFieldValue(e,t),i(!l)}},n.name))}function S({formNamePrefix:e,category:n}){const l=_.Form.useFormInstance(),i=_.Form.useWatch(e,l),s=r.useMemo((()=>{if(!i||0===i.length)return{checkAll:!0,indeterminate:!1};const e=n.services.filter((e=>e.service_category_id===n.service_category_id)).map((e=>e.service_id)),t=e.every((e=>i.includes(e)));return{checkAll:!t,indeterminate:e.some((e=>i.includes(e)))&&!t}}),[i]);return t.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},t.createElement(a.Checkbox,{id:`category-${n.service_category_id}`,checked:s.indeterminate?"indeterminate":s.checkAll,onClick:()=>(e=>{const t=e.services.filter((t=>t.service_category_id===e.service_category_id)).map((e=>e.service_id));if(s.checkAll&&!s.indeterminate){const e=[...i];e.push(...t),l.setFieldsValue({unavailable_services:e})}else{const e=i.filter((e=>!t.includes(e)));l.setFieldsValue({unavailable_services:e})}})(n)}),t.createElement(a.Label,{htmlFor:`category-${n.service_category_id}`},t.createElement("span",{className:"bw-text-base-foreground/60"},"Category"),":Â ",n.name))}function A({formNamePrefix:r}){const l=e.useActiveServices();return t.createElement("div",{className:"bw-divide-y bw-divide-base-border bw-rounded bw-border"},l.map((e=>t.createElement(a.ReactCollapsible.Root,{key:e.service_category_id,defaultOpen:!0},t.createElement("div",{className:"bw-flex bw-w-full bw-justify-between bw-bg-base-bg2/60 bw-p-3"},t.createElement(S,{formNamePrefix:r,category:e}),t.createElement(a.ReactCollapsible.Trigger,{asChild:!0},t.createElement(n.ChevronDown,{className:"bw-transition-transform data-[state=open]:bw-rotate-180"}))),t.createElement(a.CollapsibleContent,{forceMountWithAnimation:!0},t.createElement("div",{className:"bw-grid bw-grid-cols-6 bw-gap-x-4 bw-gap-y-4 bw-border-t bw-p-4"},e.services.map((e=>t.createElement("div",{className:"bw-col-span-3 sm:bw-col-span-2",key:e.service_id},t.createElement(C,{service:e,formNamePrefix:r}))))))))))}function D({formNamePrefix:l,allLabel:i}){const s=_.Form.useFormInstance(),o=_.Form.useWatch(l,s),c=e.useActiveServices(),m=r.useMemo((()=>{const e=[];return c.forEach((t=>{t.services.forEach((a=>{a.service_category_id===t.service_category_id&&e.push(a.service_id)}))})),e}),[c]),d=r.useMemo((()=>{if(!o||0===o.length)return{checkAll:!0,indeterminate:!1};const e=m.every((e=>o.includes(e)));return{checkAll:!e,indeterminate:m.some((e=>o.includes(e)))&&!e}}),[o]);return t.createElement(t.Fragment,null,t.createElement("div",{className:"bw-mb-5 bw-mt-1 bw-inline-flex bw-items-center bw-gap-2"},t.createElement(a.Checkbox,{id:"check-all",checked:d.indeterminate?"indeterminate":d.checkAll,onClick:()=>{if(d.checkAll&&!d.indeterminate){const e=[...o];e.push(...m),s.setFieldsValue({unavailable_services:e})}else{const e=o.filter((e=>!m.includes(e)));s.setFieldsValue({unavailable_services:e})}}}),t.createElement(a.Label,{htmlFor:"check-all"},i),t.createElement(a.Tooltip,{content:"Available only apply to Customer Booking Form. For Manager, there is no restriction."},t.createElement(n.HelpCircle,{className:"bw-text-info"}))),t.createElement(A,{formNamePrefix:l}))}function M(){return t.createElement(_.Form.Item,{name:"unavailable_services"},t.createElement(D,{formNamePrefix:["unavailable_services"],allLabel:"This Extra is available for all Services"}))}function I({coverSrc:e,onSelectCover:r}){const n=window.booksterMeta.appPath.bookster.assets+"/images/empty.png";return t.createElement("img",{className:a.cx("bw-mx-auto bw-my-4 bw-block bw-h-32 bw-w-32 bw-rounded bw-object-cover bw-shadow",P?"bw-cursor-pointer bw-duration-200 hover:bw-shadow-md":"bw-cursor-auto"),src:e||n,onClick:()=>{if(!P)return;const e=window.wp.media.frames.downloadable_file=window.wp.media({title:"Choose an image",multiple:!1});e.on("select",(function(){const t=e.state().get("selection").first().toJSON(),a=t.sizes.full||t.sizes.thumbnail;r({id:t.id,url:a.url})})),e.open()},alt:"Service cover"})}const P=("upload_files",function(){const e=window.booksterMeta.auth.wpUserInfo;return e.isLoggedIn?e.caps:[]}().includes("upload_files"));function q(){const e=_.Form.useFormInstance(),n=_.Form.useWatch(["quantity","activated"],e),l=c((e=>e.openExtraDrawer)),i=c((e=>e.selectedRow)),[s,o]=r.useState("");return r.useEffect((()=>{l&&o((null==i?void 0:i.transient_cover_url)?i.transient_cover_url:"")}),[l,i]),t.createElement(t.Fragment,null,t.createElement(I,{coverSrc:s,onSelectCover:t=>{e.setFieldValue("cover_id",+t.id),o(t.url)}}),t.createElement(_.Form.Item,{name:"cover_id",hidden:!0},t.createElement(a.Input,null)),t.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4 sm:bw-grid-cols-4"},t.createElement("div",{className:"bw-col-span-2"},t.createElement(_.Form.Item,{name:"name",label:"Extra Name",rules:[{required:!0}]},t.createElement(a.Input,{placeholder:"Please enter Extra Name",autoFocus:!0}))),t.createElement("div",null,t.createElement(_.Form.Item,{name:"price",label:"Extra Price",rules:[{required:!0}]},t.createElement(_.InputNumber,{min:"0",precision:2,step:5,stringMode:!0,formatter:e=>e?e.replace(/\B(?=(\d{3})+(?!\d))/g,","):"",parser:e=>e?e.replace(/(,*)/g,""):"",addonAfter:O,className:"bw-w-full"}))),t.createElement("div",null,t.createElement(_.Form.Item,{name:"duration",label:"Extra Duration",rules:[{required:!0}]},t.createElement(_.InputNumber,{min:0,addonAfter:"mins",step:N()}))),t.createElement("div",{className:"bw-col-span-2"},t.createElement(_.Form.Item,{label:"Active",name:"activated",valuePropName:"checked",rules:[{required:!0}],trigger:"onCheckedChange"},t.createElement(a.Switch,{checkedChildren:"Active",unCheckedChildren:"Inactive"}))),t.createElement("div",{className:"bw-w-full"},t.createElement(_.Form.Item,{name:["quantity","activated"],label:"Quantity",trigger:"onValueChange",rules:[{required:!0}],tooltip:"Active it if you want to add more than extra when booking"},t.createElement(a.RadioGroup,null,t.createElement(a.RadioGroupItem,{value:"enable"},"Enable"),t.createElement(a.RadioGroupItem,{value:"disable"},"Disable")))),"enable"===n&&t.createElement("div",null,t.createElement(_.Form.Item,{name:["quantity","max"],label:"Max Quantity",rules:[{required:!0},{validator:function(e,t){return null==t||t>0?Promise.resolve():Promise.reject("Extra Max Quantity must be greater than 0")}}]},t.createElement(_.InputNumber,{min:0,precision:0,step:1,className:"bw-w-full"})))))}const O=window.booksterPublicData.paymentSettings.currency_symbol??"$";function R(){const n=c((e=>e.openExtraDrawer)),l=c((e=>e.closeExtraDrawer)),{selectedExtra:i,createExtraMutation:s,updateExtraMutation:o,deleteExtraMutation:m,isFormLoading:w}=function(){const t=c((e=>e.selectedRow)),a=e.useQueryClient(),{data:n,refetch:l}=e.useQuery({queryKey:["extra",{id:null==t?void 0:t.extra_id}],queryFn:async()=>{if(!(null==t?void 0:t.extra_id))return null;const e=await b();return a.setQueryData(["extras"],e.data),e.data.find((e=>e.extra_id===(null==t?void 0:t.extra_id)))},initialData:t??null});r.useEffect((()=>{(null==t?void 0:t.extra_id)&&l()}),[null==t?void 0:t.extra_id]);const i=e.useMutation({mutationFn:d,onSuccess:e=>{a.setQueryData(["extras"],e.data)}}),s=e.useMutation({mutationFn:({id:t,values:a})=>async function(t,a){return await e.api.patch(`extras/${t}`,{json:a}).json()}(t,a),onSuccess:e=>{const r=null==e?void 0:e.data.find((e=>e.extra_id===(null==t?void 0:t.extra_id)));a.setQueryData(["extra",{id:null==r?void 0:r.extra_id}],r),a.setQueryData(["extras"],e.data)}}),o=e.useMutation({mutationFn:u,onSuccess:e=>{a.setQueryData(["extras"],e.data)}});return{selectedExtra:n,createExtraMutation:i,updateExtraMutation:s,deleteExtraMutation:o,isFormLoading:i.isLoading||s.isLoading||o.isLoading}}(),[v]=_.Form.useForm();return r.useEffect((()=>{if(n){v.resetFields();const e=i||{name:"",activated:!0,transient_cover_url:"",quantity:{activated:"disable",max:1},price:40,duration:N(),unavailable_services:[]};v.setFieldsValue(e)}}),[n,i]),t.createElement(a.DrawerRoot,{open:n,onOpenChange:e=>{e||l()}},t.createElement(a.Drawer,null,t.createElement(a.DrawerHeader,null,t.createElement(a.DrawerTitle,null,n?i?"Edit Service Extra":"New Service Extra":"Closing"),t.createElement(a.DrawerCloseIcon,null)),t.createElement(a.DrawerBody,null,t.createElement(a.LoadingOverlay,{loading:w}),t.createElement(_.Form,{form:v,disabled:w,layout:"vertical",scrollToFirstError:!0,onFinish:t=>{!async function(t){try{(null==i?void 0:i.extra_id)?await o.mutateAsync({id:i.extra_id,values:t}):await s.mutateAsync(t),a.toast.success("Extra has been Saved Successfully!"),l()}catch(r){a.toast.error(await e.getErrorMsg(r))}}(t)}},t.createElement(a.TabsRoot,{defaultValue:"general"},t.createElement(a.TabsList,{"aria-label":"tabs settings"},t.createElement(a.LineTabsTrigger,{value:"general"},"General"),t.createElement(a.LineTabsTrigger,{value:"available"},"Available")),t.createElement(a.TabsContent,{value:"general"},t.createElement(q,null)),t.createElement(a.TabsContent,{value:"available"},t.createElement(M,null))),t.createElement("button",{type:"submit",className:"bw-hidden"}))),t.createElement(a.DrawerFooter,null,i?t.createElement(F,{disabled:w,onDelete:async function(){if(null==i?void 0:i.extra_id)try{await m.mutateAsync(i.extra_id),a.toast.success("Service Extra has been Deleted Successfully!"),l()}catch(t){a.toast.error(await e.getErrorMsg(t))}}}):null,t.createElement(a.DrawerClose,{asChild:!0},t.createElement(a.Button,{key:"back",onClick:l,tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},"Cancel")),t.createElement(a.Button,{key:"submit",disabled:w,onClick:()=>v.submit(),className:"bw-min-w-[8rem]"},"Save"))))}const H=r.forwardRef((({isSaving:e,className:r,...l},i)=>t.createElement("span",{className:a.cx("bw-ms-3 bw-inline-flex bw-items-center bw-gap-2 bw-text-base bw-font-normal bw-text-base-foreground/60",!1===e&&"bw-text-success",r),...l,ref:i},null===e&&null,!1===e&&t.createElement(t.Fragment,null,t.createElement(n.CheckCircle,null)," Saved"),!0===e&&t.createElement(t.Fragment,null,t.createElement(n.Loader2,{className:"bw-animate-spin"})," Saving..."))));function V(){const e=c((e=>e.isSaving));return t.createElement("div",{className:"bw-flex bw-flex-wrap bw-items-center bw-gap-3 bw-px-5 bw-py-4 bw-pb-4"},t.createElement("h2",{className:"bw-flex bw-flex-auto bw-items-center bw-text-2xl"},"Services",t.createElement(n.ChevronRight,{className:"bw-h-5 bw-w-5"}),"Extras",t.createElement(H,{isSaving:e})))}function B(){return t.createElement("div",{className:"btr-scrollbar-md bw-relative bw-flex bw-h-full bw-flex-col bw-overflow-auto bw-overscroll-none bw-p-0"},t.createElement(V,null),t.createElement(k,null),t.createElement(R,null))}const L=(e,t)=>{for(const a of e)for(const e of a.services||[])if(e.service_id===t)return e;return null},Q=(e,t)=>{const a=e.getFieldValue("details"),r=e.getFieldValue("payment"),n={...a,booking:l.booksterHooks.applyFilters(l.HOOK_NAMES.adminApptForm.detailsReloadBookingItems,{items:[i.makeBasicItem(t)],subtotal:s.ZERO},e.getFieldsValue())},o=i.calculateDetails(n),c=i.reloadPayment(r,o.tax.total);e.setFieldsValue({details:o,payment:c})};function T(e){}function j({editMode:l="manager"}){const s=_.Form.useFormInstance(),c=_.Form.useWatch(["service_id"],s),m=_.Form.useWatch(["serviceExtras"],s),d=function(){const t=function(){const{data:t}=e.useQuery({queryKey:["extras"],queryFn:async()=>(await b()).data,keepPreviousData:!0});return t||w}();return r.useMemo((()=>t.filter((e=>e.activated))),[t])}(),u=e.useAllServices(),v=e=>{const t=m.find((t=>t.id===e));return void 0!==t?t.quantity:0},E=r.useMemo((()=>{const e=[];if(void 0!==m&&null!==c){const r=d.filter((e=>!e.unavailable_services.includes(c)));if(0===r.length)return t.createElement("span",{className:"bw-text-base-foreground/40"},"Unavailable extra on current service...");if(r.map((t=>{const a=m.find((e=>e.id===t.extra_id));a&&e.push(a.quantity>1?a.title+"(x"+a.quantity+")":a.title)})),e.length>0)return t.createElement(t.Fragment,null,e.length>2&&t.createElement("span",{className:"bw-text-base-foreground/40"},`${e.length}`," Selected"),e.map((e=>t.createElement(a.Badge,{variant:"fill",color:"muted",className:"bw-gap-2 bw-text-sm"},e))))}return t.createElement("span",{className:"bw-text-base-foreground/40"},"Select Extras...")}),[d,m,c]),x=r.useMemo((()=>"manager"!==l||null===c||0===d.filter((e=>!e.unavailable_services.includes(c))).length),[l,c,d]),f=e=>{s.setFieldValue(["serviceExtras"],e);const t=s.getFieldValue("service_id");if(null===t)return;const a=L(u,t);if(!a)throw new Error("Invalid service id");Q(s,a);let r=0;const n=s.getFieldValue("start_time")?s.getFieldValue("start_time").absMinute:0;e.forEach((e=>{const t=d.find((t=>t.extra_id===e.id));void 0!==t&&(r+=t.duration*e.quantity)})),s.setFieldsValue({end_time:i.Helper.booktime.createFromAbsMinute(n+a.duration+r)})};return t.createElement(_.Form.Item,{label:"Service Extras"},t.createElement(_.Form.Item,{hidden:!0,name:["serviceExtras"]},t.createElement(T,null)),t.createElement(a.Popover,null,t.createElement(a.ComboboxTrigger,{withStatus:!1,disabled:x},t.createElement("span",{className:"-bw-m-1 bw-inline-flex bw-gap-1 bw-overflow-x-auto",style:{scrollbarWidth:"none",msOverflowStyle:"none",scrollbarColor:"transparent transparent"}},E),t.createElement(a.ComboboxIcon,null)),t.createElement(a.PopoverPortal,{forceMount:!0},t.createElement(a.PopoverContent,{className:"bw-flex bw-w-[var(--radix-popover-trigger-width)] bw-flex-col bw-gap-2 data-[state=closed]:bw-hidden",side:"bottom"},t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-2"},null!==c&&void 0!==m&&d.filter((e=>!e.unavailable_services.includes(c))).map((e=>t.createElement("div",{className:"bw-grid bw-cursor-pointer bw-grid-cols-2 bw-items-center bw-gap-2",key:e.extra_id,onClick:()=>(e=>{let t=[...m];void 0===t.find((t=>t.id===e.extra_id))?t.push({id:e.extra_id,title:e.name,unitPrice:e.price,quantity:1,amount:e.price}):t=t.filter((t=>t.id!==e.extra_id)),f(t)})(e)},t.createElement("div",{className:"bw-flex bw-items-center"},t.createElement(n.Check,{className:a.cx("bw-mr-2 bw-h-4 bw-w-4 bw-flex-none",void 0!==m.find((t=>t.id===e.extra_id))?"bw-opacity-100":"bw-opacity-0")}),t.createElement(a.Label,null,e.name)),t.createElement("div",{className:"bw-flex bw-justify-end"},t.createElement(o,{quantity:v(e.extra_id),decrement:()=>function(e){let t=[...m];const a=t.findIndex((t=>t.id===e.extra_id));if(-1!==a){const r=t[a].quantity;r>1?t[a].quantity=r-1:1===r&&(t=t.filter((t=>t.id!==e.extra_id))),f(t)}}(e),increment:()=>function(e){const t=[...m],a=t.findIndex((t=>t.id===e.extra_id));if(-1!==a){const r=t[a].quantity;r<e.quantity.max&&(t[a].quantity=r+1)}else t.push({id:e.extra_id,title:e.name,unitPrice:e.price,quantity:1,amount:e.price});f(t)}(e)}))))))))))}e.queryClient.prefetchQuery({queryKey:["extras"],queryFn:async()=>(await b()).data}),l.booksterHooks.addFilter(l.HOOK_NAMES.router.managerRouter,"bookster-extra-options",(e=>(e.push({path:"services/extras",element:t.createElement(B,null)}),e))),l.booksterHooks.addFilter(l.HOOK_NAMES.layout.ManagerHeaderButtons,"bookster-extra-options",(()=>t.createElement(e.Route,{path:"/services/extras",element:t.createElement(m,null)}))),l.booksterHooks.addFilter(l.HOOK_NAMES.layout.managerMenuItems,"bookster-extra-options",((e,t,a)=>{const r=e.find((e=>"records"===e.key));if(!r||!r.children)return e;const n=r.children.find((e=>"services"===e.key));return n?(n.children||(delete n.onClick,n.onTitleClick=()=>{a("/services/list")},n.children=[{key:"services-list",label:"Service List",onClick:()=>{a("/services/list")}}]),n.children.push({key:"services-extras",label:"Service Extras",onClick:()=>{a("/services/extras")}}),e):e})),l.booksterHooks.addFilter(l.HOOK_NAMES.adminApptForm.AfterAgent,"bookster-extra-options",((e,a)=>[...e,t.createElement(j,{editMode:a})])),l.booksterHooks.addFilter(l.HOOK_NAMES.adminApptForm.initFormValues,"bookster-extra-options",((e,t)=>{const a=null==t?void 0:t.bookings[0];return{...e,serviceExtras:(null==a?void 0:a.extraBookingItems)||[]}})),l.booksterHooks.addAction(l.HOOK_NAMES.adminApptForm.doChangeService,"bookster-extra-options",(e=>{e.resetFields(["serviceExtras"]),e.setFieldsValue({serviceExtras:[]})})),l.booksterHooks.addAction(l.HOOK_NAMES.adminApptForm.doDetailsActionCancel,"bookster-extra-options",((e,t)=>{e.resetFields(["serviceExtras"]),e.setFieldsValue({serviceExtras:t.serviceExtras}),e.setFields(["serviceExtras"].map((e=>({name:e,touched:!1}))))})),l.booksterHooks.addFilter(l.HOOK_NAMES.adminApptForm.detailsReloadBookingItems,"bookster-extra-options",((t,a)=>{const r=a.serviceExtras;if(void 0===r||0===r.length)return t;const n=e.queryClient.getQueryData(["extras"]);return r.forEach((a=>{if(void 0!==a.id){const r=null==n?void 0:n.find((e=>e.extra_id===a.id));r&&t.items.push({id:e.genUniqueId(),title:r.name,quantity:a.quantity,unitPrice:s.Decimal.fromNumber(r.price),amount:s.ZERO})}})),t})),l.booksterHooks.addFilter(l.HOOK_NAMES.managerApptForm.prepareBookingInput,"bookster-extra-options",((e,t)=>void 0===t.serviceExtras||0===t.serviceExtras.length?e:{...e,extraBookingItems:t.serviceExtras}));
